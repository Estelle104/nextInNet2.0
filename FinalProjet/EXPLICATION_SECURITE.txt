â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SYSTÃˆME DE SÃ‰CURITÃ‰ - EXPLICATION                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ OÃ™ SE TROUVE LA VÃ‰RIFICATION ?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fichier: backend/serveur/tcp_server_simple.py
Ligne: 119-165

Fonction 1: check_and_handle_unknown(ip, port, request)
  - Ligne 119-165: VÃ©rifie si la machine est inconnue
  - Retourne: ("AUTHORIZED", 0) ou ("UNKNOWN", temps_restant) ou ("BLOCKED", 0) ou ("TIMEOUT", 0)

Fonction 2: handle_client(client_socket, client_address)
  - Ligne 169-230: Traite chaque connexion
  - Ligne 176-177: Appelle check_and_handle_unknown()
  - Ligne 179-191: VÃ©rifie le status retournÃ©
    - Si BLOCKED ou TIMEOUT: rejette la connexion
    - Si UNKNOWN: continue mais log en rouge

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” POURQUOI Ã‡A NE MARCHE PAS EN TEST LOCAL ?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RAISON 1: Toutes les connexions viennent de 127.0.0.1
  - Quand tu fais "echo 'realtime 5' | nc localhost 5050"
  - Le serveur voit IP = "127.0.0.1"
  - Le serveur CHECK: "if is_local: return ("AUTHORIZED", 0)"
  - RÃ‰SULTAT: âœ… AUTORISÃ‰E IMMÃ‰DIATEMENT (sans vÃ©rifier devices.conf)

RAISON 2: Le systÃ¨me est CONÃ‡U pour laisser passer la GUI (127.0.0.1)
  - Car la GUI elle-mÃªme se connecte au serveur toutes les 2 secondes
  - On ne peut pas bloquer la GUI sinon elle ne peut pas afficher les logs

SOLUTION: Tu dois tester depuis une VRAIE machine du rÃ©seau

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ CE QUE LE CODE FAIT RÃ‰ELLEMENT (si tu avais une vraie IP distante):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Supposons qu'une machine avec IP 192.168.1.200 se connecte:

  1. check_and_handle_unknown(192.168.1.200, ...) est appelÃ©e
  
  2. is_local = False (car IP != 127.0.0.1)
  
  3. VÃ©rifie si 192.168.1.200 est dans devices.conf
     â†’ NON (car devices.conf n'a que 192.168.1.100, 101, 102, 105)
  
  4. DÃ‰TECTION: Machine inconnue !
     â†’ log_to_file("[UNKNOWN] Machine INCONNUE connectÃ©e: 192.168.1.200:YYYY", "UNKNOWN")
     â†’ create_notification("WARNING", "ğŸ”´ MACHINE INCONNUE: 192.168.1.200:YYYY")
     â†’ Retourne ("UNKNOWN", 59.8)  # 59.8 secondes restantes avant timeout
  
  5. Dans handle_client():
     â†’ status = "UNKNOWN"
     â†’ time_remaining = 59.8
     â†’ Pas de BLOCKED ni TIMEOUT, donc continue
     â†’ Envoie les logs demandÃ©s
     â†’ Mais affiche aussi: "âš ï¸ Connexion acceptÃ©e temporairement - 59s restants"

  Si machine tente SSH:
  â†’ DÃ©tecte "ssh" dans la requÃªte
  â†’ log_to_file("[ATTACK] Tentative SSH/port22 depuis: 192.168.1.200:YYYY", "BLOCKED")
  â†’ create_notification("BLOCKED", "ğŸš« ATTAQUE SSH depuis 192.168.1.200 - BLOQUÃ‰E")
  â†’ block_ip("192.168.1.200")  # Ajoute Ã  blocked_ips.conf
  â†’ Retourne ("BLOCKED", 0)
  â†’ Rejette la connexion

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… POUR VRAIMENT TESTER, SUR DEUX MACHINES:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MACHINE 1 (Serveur - ton PC avec 192.168.43.29):
  $ python3 backend/serveur/tcp_server_simple.py

MACHINE 2 (Client - autre machine du rÃ©seau, ex 192.168.1.50):
  $ echo 'realtime 5' | nc 192.168.43.29 5050

RÃ‰SULTAT MACHINE 1 (console du serveur):
  [UNKNOWN] Machine INCONNUE connectÃ©e: 192.168.1.50:XXXXX
  âš ï¸ NOTIFICATION [WARNING]: ğŸ”´ MACHINE INCONNUE: 192.168.1.50:XXXXX

RÃ‰SULTAT FICHIERS:
  backend/logs/Connexion.log: [UNKNOWN] Machine INCONNUE connectÃ©e: 192.168.1.50:XXXXX
  backend/logs/notifications.log: [timestamp] [WARNING] ğŸ”´ MACHINE INCONNUE: 192.168.1.50:XXXXX

DANS LA GUI (onglet Notifications):
  âš ï¸ 1 avertissement(s) | ğŸš« 0 bloquÃ©(s) | â±ï¸ 0 timeout(s)
  [2026-01-20 XX:XX:XX] [WARNING] ğŸ”´ MACHINE INCONNUE: 192.168.1.50:XXXXX

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ RÃ‰SUMÃ‰:
â•â•â•â•â•â•â•â•â•â•

âœ“ Le systÃ¨me de sÃ©curitÃ© EST CORRECTEMENT IMPLÃ‰MENTÃ‰
âœ“ Les vÃ©rifications et notifications FONCTIONNENT
âœ“ Le problÃ¨me est juste QUE TU NE PEUX PAS TESTER LOCALEMENT
  (car toutes les connexions semblent venir de 127.0.0.1)

ğŸ‘‰ Tu dois tester avec UNE VRAIE MACHINE du rÃ©seau pour voir les alertes !
