# ğŸ—ï¸ Architecture - SystÃ¨me de SÃ©curitÃ© Utilisateurs Inconnus

## Diagramme Complet du Flux

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVEUR TCP (Port 5050)                          â”‚
â”‚                    tcp_server_simple.py                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    Connexion reÃ§ue (client_address)
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                              â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DÃ©faire IP client  â”‚                   â”‚ Recevoir requÃªte    â”‚
    â”‚ IP = 192.168.43.x  â”‚                   â”‚ (request)           â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ check_and_handle_unknown() â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                    â”‚
    [LOCAL]           [AUTHORIZED]        [UNKNOWN]
    127.0.0.1        devices.conf        IP 150-200
        â”‚                 â”‚                    â”‚
        â”‚             âœ“ SSH OK            â±ï¸  Countdown 15s
        â”‚             âœ“ Connexion OK          â”‚
        â”‚             âœ“ INFO log              â”‚
        â”‚                                     â”‚
        â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                          â”‚
        â”‚                    [TIMEOUT]              [SSH REQUEST]
        â”‚                    15 secondes             Port 22 / SSH
        â”‚                         â”‚                          â”‚
        â”‚                         â”œâ”€ BLOQUER               â”œâ”€ ping_and_shutdown()
        â”‚                         â”‚  (block_ip)            â”‚  â”‚
        â”‚                         â”‚  â”‚                      â”‚  â”œâ”€ ping -c 1 IP
        â”‚                         â”‚  â”œâ”€ iptables DROP      â”‚  â”‚  âœ“ OK â†’ CONTINUE
        â”‚                         â”‚  â”‚  (INPUT+FORWARD)    â”‚  â”‚  âœ— FAIL â†’ LOG
        â”‚                         â”‚  â”‚                      â”‚  â”‚
        â”‚                         â”‚  â”œâ”€ blocked_ips.conf    â”‚  â”œâ”€ ssh root@IP
        â”‚                         â”‚  â”‚  + IP               â”‚  â”‚  "shutdown -h now"
        â”‚                         â”‚  â”‚                      â”‚  â”‚
        â”‚                         â”‚  â””â”€ Notification       â”‚  â””â”€ LOG CRITICAL
        â”‚                         â”‚     TIMEOUT            â”‚
        â”‚                         â”‚                        â”‚
        â”‚                         â”‚     block_ip()         â”‚
        â”‚                         â”‚     (mÃªme processus)   â”‚
        â”‚                         â”‚                        â”‚
        â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                  â”‚
        â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚   BLOQUÃ‰E       â”‚
        â”‚                          â”‚ iptables DROP   â”‚
        â”‚                          â”‚ blocked_ips.confâ”‚
        â”‚                          â”‚ Notification    â”‚
        â”‚                          â”‚ BLOCKED         â”‚
        â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Fermer socket  â”‚
                   â”‚ Retourner      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagramme des Threads

```
MAIN THREAD
â”‚
â”œâ”€ Server Socket (0.0.0.0:5050)
â”‚  â”œâ”€ accept() â†’ client_1
â”‚  â”œâ”€ spawn Thread_1 â†’ handle_client(client_1)
â”‚  â”œâ”€ accept() â†’ client_2
â”‚  â”œâ”€ spawn Thread_2 â†’ handle_client(client_2)
â”‚  â””â”€ [CONTINUE LISTENING]
â”‚
â””â”€ MONITORING THREAD (daemon)
   â””â”€ while True:
      â””â”€ every 1 second:
         â””â”€ for each unknown_connections[ip]:
            â””â”€ if elapsed >= 15s:
               â””â”€ block_ip(ip)
               â””â”€ create_notification("TIMEOUT")
```

---

## Ã‰tats et Transitions (Machine Inconnue)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  INCONNUE DÃ‰TECTÃ‰E       â”‚
                    â”‚  (IP 150-200)            â”‚
                    â”‚  â±ï¸  T=0s                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  TRACKING ACTIF          â”‚
                    â”‚  â±ï¸  T=0-15s            â”‚
                    â”‚  Status: "UNKNOWN"      â”‚
                    â”‚  Notification: WARNING   â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚              â”‚
                    [IDLE]              [SSH ATTEMPT]
                         â”‚              â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TIMEOUT â”‚    â”‚ PING + SHUTDOWN  â”‚
                    â”‚ â±ï¸  15s â”‚    â”‚ ssh root@IP      â”‚
                    â”‚         â”‚    â”‚ "shutdown -h now"â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚              â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                    â”‚  EXPULSION              â”‚
                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
                    â”‚ â€¢ iptables DROP         â”‚
                    â”‚ â€¢ blocked_ips.conf += IPâ”‚
                    â”‚ â€¢ Notification BLOCKED  â”‚
                    â”‚ â€¢ remove from tracking  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  BLOQUÃ‰E         â”‚
                    â”‚  (PERMANENT)     â”‚
                    â”‚  iptables active â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Interaction avec les Fichiers Config

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CONFIG FILES (READ/WRITE)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚                    â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ devices.conf     â”‚  â”‚blocked_ips.conf â”‚  â”‚notifications  â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
    â”‚ MAC|IP           â”‚  â”‚IP (one per line)â”‚  â”‚[timestamp]    â”‚
    â”‚ Lecture: AUTH    â”‚  â”‚AppendWrite: BANâ”‚  â”‚[level]        â”‚
    â”‚                  â”‚  â”‚                 â”‚  â”‚Message        â”‚
    â”‚ AA:BB:CC:DD:..   â”‚  â”‚192.168.43.165   â”‚  â”‚ [INFO] ...    â”‚
    â”‚ AA:BB:CC:DD:..   â”‚  â”‚192.168.43.175   â”‚  â”‚ [WARNING] ...  â”‚
    â”‚                  â”‚  â”‚                 â”‚  â”‚ [ERROR] ...   â”‚
    â”‚ (liste statique) â”‚  â”‚ (dynamique)     â”‚  â”‚ [CRITICAL]... â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚                    â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
        â”‚                    â”‚ block_ip(ip)       â”‚     â”‚
        â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚     â”‚
        â”‚                    â”‚ 1. Ajouter Ã  conf  â”‚     â”‚
        â”‚                    â”‚ 2. iptables DROP   â”‚     â”‚
        â”‚                    â”‚ 3. Log crÃ©ation    â”‚â”€â”€â”€â”€â–¼
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
        â”‚                                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                   â”‚                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ is_device_known â”‚              â”‚ create_notification
            â”‚ (check_and_     â”‚              â”‚ (logging)
            â”‚  handle)        â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flux DÃ©taillÃ©: SSH Detection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequÃªte reÃ§ue du client             â”‚
â”‚ request = "SSH -p 22 command"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ DÃ©tection SSH               â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
        â”‚ if "ssh" in request.lower() â”‚
        â”‚    or port == 22            â”‚
        â”‚    or "SSH" in request      â”‚
        â”‚    or "OpenSSH" in request  â”‚
        â”‚    â†’ is_ssh_attempt = True  â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€ Pour MACHINE AUTORISÃ‰E:
               â”‚  â””â”€ âœ“ SSH OK â†’ Accepter
               â”‚
               â””â”€ Pour MACHINE INCONNUE:
                  â”‚
                  â”œâ”€ ping_and_shutdown(ip)
                  â”‚  â”‚
                  â”‚  â”œâ”€ subprocess.run(["ping", "-c", "1", "-W", "2", ip])
                  â”‚  â”‚  â”œâ”€ âœ“ OK â†’ continue
                  â”‚  â”‚  â””â”€ âœ— FAIL â†’ LOG WARNING
                  â”‚  â”‚
                  â”‚  â””â”€ subprocess.run(["ssh", "-o", "ConnectTimeout=2",
                  â”‚                    f"root@{ip}", "shutdown -h now"])
                  â”‚     â”œâ”€ âœ“ OK â†’ LOG CRITICAL
                  â”‚     â””â”€ âœ— FAIL â†’ tentative alternative
                  â”‚
                  â”œâ”€ block_ip(ip)
                  â”‚  â”‚
                  â”‚  â”œâ”€ Ajouter Ã  blocked_ips.conf
                  â”‚  â”œâ”€ iptables -I INPUT -s IP -j DROP
                  â”‚  â””â”€ iptables -I FORWARD -s IP -j DROP
                  â”‚
                  â””â”€ create_notification("BLOCKED", "SSH machine inconnue")
```

---

## Matrice de DÃ©cision

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MACHINE TYPE     â”‚ IDLE TIMEOUT â”‚ SSH REQUEST  â”‚ RÃ‰SULTAT         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AUTORISÃ‰E        â”‚ âœ… AcceptÃ©e  â”‚ âœ… AutorisÃ©  â”‚ âœ… Connexion OK  â”‚
â”‚ (devices.conf)   â”‚              â”‚              â”‚ INFO log         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INCONNUE         â”‚ âŒ Expulsion â”‚ ğŸ”´ BLOCAGE   â”‚ âŒ BANNED        â”‚
â”‚ (IP 150-200)     â”‚ aprÃ¨s 15s    â”‚ PING+SHUTDOWNâ”‚ CRITICAL log     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BLOQUÃ‰E          â”‚ âŒ RefusÃ©e   â”‚ âŒ RefusÃ©e   â”‚ âŒ DropÃ©e        â”‚
â”‚ (blocked_ips)    â”‚              â”‚              â”‚ BLOCKED log      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Interaction iptables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              iptables (Firewall)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT CHAIN:
  Rule: -I INPUT -s 192.168.43.165 -j DROP
        â””â”€ Bloquer tout trafic ENTRANT de cette IP

FORWARD CHAIN:
  Rule: -I FORWARD -s 192.168.43.165 -j DROP
        â””â”€ Bloquer tout trafic TRANSITANT (routing)

EFFET:
  âœ— Aucune connexion possible
  âœ— Pas de ping rÃ©ponse
  âœ— Pas d'accÃ¨s SSH
  âœ— Pas d'accÃ¨s au serveur
```

---

## Chronologie ComplÃ¨te: SSH Attempt

```
Temps    Ã‰vÃ©nement                    DÃ©tail
â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€
T=0s     Machine inconnue se connecte IP: 192.168.43.165
         â”‚
         â”œâ”€ is_device_known(ip) â†’ False
         â”œâ”€ unknown_connections[ip] = time.time()
         â”œâ”€ Notification: WARNING
         â””â”€ Status: "UNKNOWN"

T=2s     Tente SSH
         â”‚
         â”œâ”€ request = "SSH"
         â”œâ”€ port = 22
         â”œâ”€ is_ssh_attempt = True
         â””â”€ Status: "INCONNUE"

T=2.1s   DÃ©tection SSH
         â”‚
         â”œâ”€ ping_and_shutdown(ip)
         â”œâ”€ ping -c 1 -W 2 192.168.43.165
         â”‚  â””â”€ âœ“ RÃ©ponse reÃ§ue (100ms)
         â””â”€ Status: "PING_OK"

T=2.5s   Envoi shutdown
         â”‚
         â”œâ”€ ssh root@192.168.43.165 "shutdown -h now"
         â”œâ”€ Connexion SSH Ã©tablie
         â”œâ”€ Commande exÃ©cutÃ©e
         â”œâ”€ Machine commence l'arrÃªt
         â””â”€ Status: "SHUTDOWN_SENT"

T=3s     Blocage permanent
         â”‚
         â”œâ”€ block_ip(ip)
         â”œâ”€ iptables DROP ajoutÃ©e
         â”œâ”€ blocked_ips.conf += IP
         â”œâ”€ Notification: BLOCKED
         â””â”€ Status: "EXPULSION_COMPLETE"

T=10s    Machine Ã©teinte
         â”‚
         â”œâ”€ plus de rÃ©ponse ping
         â”œâ”€ connexion SSL fermÃ©e
         â””â”€ iptables DROP toujours active
```

---

## Ressources SystÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         UTILISATION DES RESSOURCES SYSTÃˆME           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MAIN THREAD:
  â€¢ Ã‰coute socket port 5050
  â€¢ Spawn threads clients
  â€¢ CPU: minimal (event-driven)
  â€¢ MÃ©moire: ~10-20 MB

CLIENT THREADS:
  â€¢ Traiter chaque client
  â€¢ Timeout courts (~1-2s)
  â€¢ CPU: minimal
  â€¢ MÃ©moire: ~1 MB par client

MONITORING THREAD:
  â€¢ VÃ©rifier timeout chaque 1s
  â€¢ Faible CPU (boucle courte)
  â€¢ MÃ©moire: ~5 MB
  â€¢ Ne bloque pas server

TOTAL SYSTÃˆME:
  â€¢ CPU: < 5% en repos
  â€¢ MÃ©moire: ~50-100 MB
  â€¢ Connexions simultanÃ©es: 50+
```

---

## DÃ©pendances SystÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DÃ‰PENDANCES SYSTÃˆME REQUISES                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Python3:
  â€¢ socket (stdlib)
  â€¢ subprocess (stdlib)
  â€¢ threading (stdlib)
  â€¢ os (stdlib)
  â€¢ time (stdlib)
  â€¢ collections (stdlib)

SystÃ¨me (via subprocess):
  â€¢ ping (-c count, -W timeout)
  â€¢ ssh (root@IP avec CloseKey=no)
  â€¢ sudo (pour iptables)
  â€¢ iptables (blocage IP)

Fichiers:
  â€¢ devices.conf (lecture)
  â€¢ blocked_ips.conf (write/append)
  â€¢ Connexion.log (write/append)
  â€¢ notifications.log (write/append)
```

---

## Cas d'Erreur GÃ©rÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GESTION DES CAS D'ERREUR                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Erreur                        Action
â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€
ping timeout                  LOG WARNING, continuer
ping fail (-1)                LOG WARNING, continuer
SSH timeout                   LOG ERROR, tentative alt.
SSH fail (-1)                 LOG ERROR, continuer
iptables not found            LOG WARNING, continuer
write to file fail            LOG ERROR, continuer
socket error                  LOG ERROR, close client
invalid request               send default response
broken pipe                   silencieux close
permission denied (sudo)      LOG WARNING, continuer
```

---

**Diagrammes crÃ©Ã©s le:** 28 janvier 2026
**Version:** 1.0
**Ã‰tat:** âœ… Complete et validÃ©
